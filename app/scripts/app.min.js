angular.module("eventApp",["ui.router","firebase","ngMessages"]).config(["$urlRouterProvider","$stateProvider",function(e,t){e.otherwise("/"),t.state("main",{url:"/",templateUrl:"views/main.html",controller:"EventListController",controllerAs:"eventsCtrl",resolve:{initialData:["eventFactory",function(e){return e.getAll()}]}}),t.state("create",{url:"/create",templateUrl:"views/create.html",controller:"NewEventController",controllerAs:"newEventCtrl",resolve:{currentAuth:["authFactory",function(e){var t=e.auth();return console.log(t),t.$requireAuth()}]}}),t.state("loginn",{url:"/login",templateUrl:"views/login.html",controller:"loginController",controllerAs:"loginCtrl"}),t.state("signup",{url:"/signup",templateUrl:"views/signup.html",controller:"signupController",controllerAs:"signCtrl"})}]).constant("FBMSG","https://eventplannerapp-098.firebaseio.com/Events").factory("eventFactory",["FBMSG","$firebaseArray",function(e,t){var n={},o=new Firebase(e),r=t(o);return n.getAll=function(){return console.log(r),r},n}]).factory("authFactory",["FBMSG","$firebaseAuth",function(e,t){var n={},o=new Firebase(e),r=t(o);return console.log(r),n.createUser=function(e,t,n){return r.$createUser({userName:n,email:e,password:t})},n.authUser=function(e,t){return r.$authWithPassword({email:e,password:t})},n.logout=function(){r.$unauth()},n.auth=function(){return r},n}]).factory("addressService",function(){return{autocomplete:null,initAutocomplete:function(e){this.autocomplete=new google.maps.places.Autocomplete(document.getElementById(e),{types:["geocode"]})},getLocation:function(){var e=this;navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(t){var n={lat:t.coords.latitude,lng:t.coords.longitude},o=new google.maps.Circle({center:n,radius:t.coords.accuracy});e.autocomplete.setBounds(o.getBounds())})}}}).directive("focusElement",function(){return{restrict:"A",link:function(e,t,n){t.focus()}}}).controller("NavController",["$scope",function(e){e.toggleNb=function(){angular.element(document.querySelector(".navbar-collapse")).removeClass("in")}}]).controller("NewEventController",["$scope","FBMSG","$state","addressService",function(e,t,n,o){e.myData=new Firebase(t),e.addEvent=function(){e.event.start=e.event.evstart.getTime(),e.event.end=e.event.evend.getTime(),alert("You have saved:"+e.event.title),e.myData.push(e.event),console.log("User successfully created event"),n.go("main")},e.validTime=function(){return e.event&&e.event.evend?e.event.evstart<e.event.evend:!0};var r=$("#location");r.on("focus",function(){var t=$(this);o.initAutocomplete(t.attr("id")),o.getLocation(),o.autocomplete.addListener("place_changed",function(){e.event.location=r.val()})})}]).controller("EventListController",["eventFactory","authFactory","$scope","$state","initialData",function(e,t,n,o,r){var l=this;l.eventList=r,l["delete"]=function(t){e.deleteEvent(t).then(function(e){})}}]).controller("loginController",["authFactory","$scope","$state",function(e,t,n){function o(e){var t=e.title,n=e.detail,o="alert "+e.className;l.removeClass().addClass(o),l.children("#alert-title").text(t),l.children("#alert-detail").text(n)}var r=this,l=$("#login-alert");r.login=function(){var t=e.authUser(r.loginEmail,r.loginPassword);t.then(function(e){console.log("User successfully logged in with uid: ",e.uid),n.go("create")},function(e){console.log("Authentication failed: ",e),o({title:"You are not logged in",detail:"Invalid email/password combination",className:"alert-danger"})})}}]).controller("signupController",["FBMSG","authFactory","$scope","$state",function(e,t,n,o){var r=this,l=document.getElementById("eight-plus"),a=document.getElementById("uppercase"),i=document.getElementById("numbers"),s=document.getElementById("password"),c=/[A-Z]/,u=/[a-z]/,g=/[0-9]/;s.addEventListener("input",function(){var e=s.value;e.length>=8?l.classList.add("glyphicon-ok"):l.classList.remove("glyphicon-ok"),c.test(e)&&u.test(e)?a.classList.add("glyphicon-ok"):a.classList.remove("glyphicon-ok"),g.test(e)?i.classList.add("glyphicon-ok"):i.classList.remove("glyphicon-ok");e.length>=8&&c.test(e)&&g.test(e)}),r.signUp=function(){var e=t.createUser(r.email,r.password,r.userName);e.then(function(e){console.log("User successfully created with uid: ",e.uid),console.log(e),o.go("loginn")},function(e){console.log("Error creating user: ",e)})}}]).run(["$rootScope","$state",function(e,t){e.$on("$stateChangeError",function(e,n,o,r){console.log(r),(r="AUTH_REQUIRED")&&(console.log("Error in Auth"),t.go("loginn"))})}]);